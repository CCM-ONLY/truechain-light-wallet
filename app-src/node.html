<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="dist/css/my/node.css" />
	</head>

	<body>
		<div class="bg-top">
			<div class="top-title">节点</div>
			<div class="my-module">
				<div class="signUP left">
					<div class="icon signUp-icon"></div>
					<div class="text">报名参选</div>
				</div>
				<div class="vote right">
					<div class="icon vote-icon"></div>
					<div class="text">投票</div>
				</div>
			</div>
		</div>

		<div id="slider" class="mui-slider">
			<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted bg-w">
				<a class="mui-control-item mui-active" href="#item1mobile">
					标准节点排行
				</a>
				<a class="mui-control-item" href="#item2mobile">
					全节点排行
				</a>
			</div>
			<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
			<div class="mui-slider-group">
				<div id="item1mobile" class="base-info md-f1 mui-slider-item mui-control-content detailInfos md-box md-ver mui-active">
					<ul class="mui-table-view standardNode">
						<!--						
						<li class="mui-table-view-cell">
							<div class="view-cell-left">
								<img class="ranking" src="dist/images/common/three@2x.png" />
							</div>
							<div class="view-cell-center nickName">
								<span>全力以赴全力以赴</span>
							</div>
							<div class="view-cell-center-item">
								1200true
							</div>
							<div class="view-cell-right voteNum">
								12000票
							</div>
						</li>-->
					</ul>
				</div>
				<div id="item2mobile" class="process bg md-f1 mui-slider-item mui-control-content detailInfos1 md-box md-ver">
					<ul class="mui-table-view fullNode">
						<!--<li class="mui-table-view-cell">
							<div class="view-cell-left">
								<img class="ranking" src="dist/images/common/one@2x.png" />
							</div>
							<div class="view-cell-center nickName">
								<span>全力以赴全力以赴</span>
								<img class="type" src="dist/images/common/geren.png" />
							</div>
							<div class="view-cell-center-item">
								1200true
							</div>
							<div class="view-cell-right voteNum">
								12000票
							</div>
						</li>-->
					</ul>
				</div>
			</div>
		</div>
	</body>

</html>
<script src="lib/js/mui.min.js"></script>
<script src="lib/js/zepto.min.js"></script>
<script src="lib/js/h.min.js"></script>
<script type="text/javascript" src="lib/js/zepto.min.js"></script>
<script src="src/js/common.js"></script>

<script type="text/javascript">
	let nodeDataUrl = 'http://192.168.31.2:7001/nodeRank',
		isSuccessUrl = '';

	mui.plusReady(function() {
		let token = plus.storage.getItem('token');
		let keystore = plus.storage.getItem('keystore');
		h('.signUP').tap(function() {
			if(true) { //res.state==0 -- > 初始状态
				openInfo('view/node/signUp.html', {
					token: token,
					state: 0
				})
				return;
			} else if(!true) { //res.state==1 -- > 报名申请中
				openInfo('view/node/organizeTeamNode/joinOrganize.html', {
					token: token,
					state: 1
				})
				return;
			} else if(!true) { //res.state==2 报名成功
				openInfo('view/node/signUpSuccess.html', {
					token: token,
					//type:res.data.type,
					state: 2
				});
				return
			} else { //res.state==3 报名失败 -- > 继续选择报名
				openInfo('view/node/organizeTeamNode/joinOrganize.html', {
					token: token,
					state: 3
				})
			}
		});

		//投票
		h('.vote').tap(function() {
			openInfo('view/node/vote.html', {
				token: token
			});
		});

		/*请求数据列表渲染*/
		var getAjaxPromise = function(option) {
			return new Promise(function(resolve, reject) {
				mui.ajax(option.url, {
					type: 'get',
					dataType: 'json',
					headers: {
						token: token
					},
					data: {
						node_type: option.node_type
					},
					async: true,
					success: function(res) {
						resolve(res)
					},
					error: function(error) {
						reject(error)
					}
				});
			})
		}

		request(1, '.standardNode');
		request(2, '.fullNode');

		function request(node_type, element) {
			getAjaxPromise({
				url: nodeDataUrl,
				node_type: node_type
			}).then((res) => {
				Data = res.data.sort(function(a, b) {
					return b.tickets - a.tickets
				});
				let rankingBeArr = Data.splice(0, 3);
				//前三名
				rankingBeArr.forEach(function(item, index) {
					let str;
					if(item.type == 1) {
						str = `<li class="mui-table-view-cell">
																	<div class="view-cell-left">
																		<img class="ranking" src="dist/images/common/${index}@2x.png" />
																	</div>
																	<div class="view-cell-center nickName">
																		<span>${item.nickname}</span>
																		<img class="type" src="dist/images/common/geren.png" />
																	</div>
																	<div class="view-cell-center-item">
																		${item.tickets}true
																	</div>
																	<div class="view-cell-right voteNum">
																		${item.tickets}票
																	</div>
																</li>`;
					} else {
						str = `<li class="mui-table-view-cell">
																	<div class="view-cell-left">
																		<img class="ranking" src="dist/images/common/${index}@2x.png" />
																	</div>
																	<div class="view-cell-center nickName">
																		<span>${item.nickname}</span>
																	</div>
																	<div class="view-cell-center-item">
																		${item.tickets}true
																	</div>
																	<div class="view-cell-right voteNum">
																		${item.tickets}票
																	</div>
																</li>`;
					};
					$(element).append(str);
				});

				//之后
				let ranking = Data.sort(function(a, b) {
					return b.voteNum - a.voteNum;
				});

				ranking.forEach(function(item, index) {
					let strAf;
					if(item.type == 1) {
						strAf = `<li class="mui-table-view-cell">
																	<div class="view-cell-left">
																		${index+4}
																	</div>
																	<div class="view-cell-center nickName">
																		<span>${item.nickname}</span>
																		<img class="type" src="dist/images/common/geren.png" />
																	</div>
																	<div class="view-cell-center-item">
																		${item.tickets}true
																	</div>
																	<div class="view-cell-right voteNum">
																		${item.tickets}票
																	</div>
																</li>`;
					} else {
						strAf = `<li class="mui-table-view-cell">
																	<div class="view-cell-left">
																		${index+4}
																	</div>
																	<div class="view-cell-center nickName">
																		<span>${item.nickname}</span>
																	</div>
																	<div class="view-cell-center-item">
																		${item.tickets}true
																	</div>
																	<div class="view-cell-right voteNum">
																		${item.tickets}票
																	</div>
																</li>`;
					};
					$(element).append(strAf);
				})
			}).catch((err) => {
				console.log('Error' + JSON.stringify(err))
			});
		}

	})
</script>