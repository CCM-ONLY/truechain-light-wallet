"use strict";

//页面跳转
mui.plusReady(function() {
	let host = plus.storage.getItem('web3Host');
	if(!host) {
		host = "https://mainnet.infura.io/";
	}

	(function() {
		var web3 = new Web3(new Web3.providers.HttpProvider(host));

		var Wallet = {
			init: function init() {
				var that = this;
				//页面跳转
				this.turnUrl(".e-setup", "setup.html", "setup");
				this.turnUrl(".e-import", "importwallet.html", "importwallet");

				//获取资产情况
				var addresses = plus.storage.getItem('walletAddress');
				web3.eth.getBalance(addresses).then(function(res) {
					var balance = res;
					balance = that.show(web3.utils.fromWei(balance, 'ether'));
					//钱包列表
					let string = `<li class='mywallet'>
					<section>
						<i class="avatar"></i>
						<div class="wallet-info">
							<p class="title">${plus.storage.getItem('walletName')}</p>
							<p class="code">${plus.storage.getItem('walletAddress')}</p>
						</div>
						<span class="mui-navigate-right"></span>
					</section>
					<section>
						<span>${balance}<i>ether</i></span>
					</section>
				</li>`;
					$('.wallet-list').append(string);
					that.turnUrl(".mywallet", "../../asset/userinfo.html", "userinfo");
				});
			},
			turnUrl: function turnUrl(elements, url, id) {
				$(elements).on('tap', function() {
					openInfo(url, id);
				});
			},
			show: function show(num) {
				num += '';
				num = num.replace(/[^0-9|\.]/g, '');
				if(/^0+/) {
					num = num.replace(/^0+/, '');
				};
				if(!/\./.test(num)) {
					num += '.00000';
				};
				if(/^\./.test(num)) {
					num = '0' + num;
				};
				num += '00000';
				num = num.match(/\d+\.\d{5}/)[0];
				return num
			}
		};
		Wallet.init();
	})();
})