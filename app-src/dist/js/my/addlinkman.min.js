'use strict';

(function () {
	mui('.ercode-icon')[0].addEventListener('tap', function () {
		mui.openWindow("../wallet/ercode.html", "ercode");
	});

	var Validate = {
		$maskerLoading: $('.masker-loading'),
		$blackMask: $('.masker-black'),
		//初始化
		phone: null,
		isEmpty: true,
		//验证是否通过 
		phoneFlag: false,
		//验证正则
		phoneReg: /^1(3|4|5|7|8)\d{9}$/,
		init: function init() {
			this.submitForm();
		},
		checkEmpty: function checkEmpty(val) {
			if (val) {
				this.isEmpty = false;
			}
		},
		checkPhone: function checkPhone(elements, errContainer) {
			this.phone = $(elements).val();
			this.checkEmpty(this.phone);
			if (this.isEmpty) {
				$(errContainer).removeClass("mui-hidden");
				$(errContainer).text("请输入电话号码");
				return;
			} else if (!this.phoneReg.test(this.phone)) {
				$(errContainer).removeClass("mui-hidden");
				$(errContainer).text("请输入正确的电话号码");
				return;
			} else {
				this.phoneFlag = true;
				$(errContainer).addClass("mui-hidden");
				$(errContainer).text("");
			}
			return this;
		},
		submitForm: function submitForm() {
			var that = this;
			$("#star-setup").on('tap', function () {
				that.checkPhone('.e-phone', '.phone-error');
				if (that.phoneFlag) {
					$(this).addClass("mui-disabled");
					that.showLoading(true, true);
					mui.toast("创建成功");
					setTimeout(function () {
						mui.openWindow('../../../asset.html', 'asset');
						that.showLoading(false, false);
					}, 3000);
				}
			});
		},
		showLoading: function showLoading(show) {
			var masker = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

			this.$maskerLoading[0].className = show ? 'masker-loading' : 'masker-loading mui-hidden';
			this.$blackMask[0].className = masker ? 'masker-black' : 'masker-black mui-hidden';
		}
	};
	Validate.init();
})();