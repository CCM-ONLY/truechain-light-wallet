'use strict';

/*mui('.setting')[0].addEventListener('tap', function() {
	mui.openWindow("switchaccount.html", "switchaccount");
});*/

mui.plusReady(function() {
	let address = plus.storage.getItem('walletAddress');
	let host = plus.storage.getItem('web3Host');
	let apiUrl = '';
	let reg = /https:\/\/ropsten.infura.io/;

	if(reg.test(host)) {
		apiUrl = 'http://api-ropsten.etherscan.io/api?'
	} else {
		apiUrl = 'http://api.etherscan.io/api?'
	}

	let url = `${apiUrl}module=account&action=txlist&address=${address}&startblock=0&endblock=99999999&sort=desc&apikey=YourApiKeyToken`;

	console.log(url)
	mui.ajax(url, {
		dataType: 'json',
		type: 'get',
		timeout: 9999,
		async: true,
		headers: {
			'Content-Type': 'application/json'
		},
		success: function(data) {
			console.log(JSON.stringify(data))
			let result = data.result;

			result.forEach(function(item, index) {
				let string;
				if(item.txreceipt_status == '1') {
					string = `
				<li class="clearfix border-1px">
					<i class="icon icon-expend"></i>
					<div class="info">
						<p class='address'>${item.to}</p>
						<span class="expend">-${item.value/1000000000000000000} </span>
					</div>
					<div class="date">
						
					</div>
				</li>`;
				} else {
					string = `
				<li class="clearfix border-1px">
					<i class="icon icon-earning"></i>
					<div class="info">
						<p class='address'>${item.to}</p>
						<span class="earning">+${item.value/1000000000000000000}</span>
					</div>
					<div class="date">
						
					</div>
				</li>`;
				}
				$('.transactionRecord').append(string)
			})
		},
		error: function(xhr, type, errorThrown) {
			console.log(type)
		}
	})
})