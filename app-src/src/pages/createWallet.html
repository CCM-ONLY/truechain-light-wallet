<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/reset.css" />
		<link rel="stylesheet" href="../css/createWallet.css" />
		<style type="text/css">
			.ywz_zhuce_bao {
				float: left;
				width: 640px;
				height: 360px;
				padding: 30px 0px 0px 66px;
				border-right: 1px dashed #e5e5e5;
			}
			
			.ywz_zhucexiaobo {
				float: left;
				width: 620px;
				padding-bottom: 10px;
				padding-top: 5px;
				margin-left: 20px;
			}
			
			.ywz_zhuce_youjian {
				float: left;
				width: 100px;
				margin: 5px 0 0 0;
				font-size: 14px;
				text-align: right;
			}
			/*用户*/
			
			.ywz_zhuce_yongyu1 {
				float: left;
				color: #C00;
				font-size: 12px;
				padding-left: 10px;
				margin-top: 10px;
			}
			/*后面的文字*/
			
			.ywz_zhuce_yongyu1 a {
				color: #C00;
				text-decoration: none;
			}
			
			.ywz_zhuce_yongyu1 a:hover {
				color: #C00;
			}
			
			.ywz_zhuce_xiaoxiaobao {
				float: left;
				width: 226px;
			}
			
			.ywz_zhuce_hongxian {
				float: left;
				background: #ff3300;
				width: 30px;
				height: 4px;
				margin-top: 5px;
				font-size: 0px;
			}
			
			.ywz_zhuce_hongxian2 {
				float: left;
				background: #099;
				width: 30px;
				height: 4px;
				margin-top: 5px;
				font-size: 0px;
			}
			
			.ywz_zhuce_hongxian3 {
				float: left;
				background: #060;
				width: 30px;
				height: 4px;
				margin-top: 5px;
				font-size: 0px;
			}
			
			.ywz_zhuce_huixian {
				background: #d6d3d3;
				width: 30px;
				height: 4px;
				margin-top: 5px;
				font-size: 0px;
			}
			/*框*/
			
			.ywz_zhuce_kuangwenzi1 {
				border: 0;
				color: #3e3e3e;
				width: 210px;
				height: 40px;
				line-height: 35px;
				padding-left: 25px;
				_padding-left: 20px;
				outline: medium;
			}
			
			.tishi {
				display: flex;
				align-items: center;
			}
			
			.tishi_item {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">创建钱包</h1>
		</header>
		<div class="mui-content">
			<div class="Instructions">
				<div class="center">
					<p class="white">○&nbsp;密码用于加密私钥,强度非常重要!</p>
					<p class="white">○&nbsp;Ture钱包不会存储密码,也无法帮您找回,请务必牢记!</p>
				</div>
			</div>

			<form class="mui-input-group">
				<div class="mui-input-row">
					<input id="walletName" type="text" class="mui-input-clear" placeholder="输入钱包名称">
				</div>
				<div class="mui-input-row tishi">
					<input name="tbPassword" type="password" id="tbPassword" class="ywz_zhuce_kuangwenzi1" placeholder="输入您的密码" />
					<div class="tishi_item">
						<div class="ywz_zhuce_huixian" id='pwdLevel_1'> </div>
						<div class="ywz_zhuce_huixian" id='pwdLevel_2'> </div>
						<div class="ywz_zhuce_huixian" id='pwdLevel_3'> </div>
					</div>
				</div>

				<div class="mui-input-row">
					<input id="confirmPwd" type="password" placeholder="确认您的密码">
				</div>

				<div class="box center">
					<span class="check">
　　　　<input type="radio" name="radio" id="check1">
　　　　<label for="check1"></label>
　　</span>
					<label for="check1">我已仔细阅读并同意《服务及隐私条款》</a></label>
				</div>
				<div class="options_item center">
					<a id="creat-wallet" class="options_item_bg r bs white">创建钱包</a>
				</div>
				<p id="lead-wallet" class="lead-wallet">导入钱包</p>
			</form>
		</div>
	</body>

</html>
<script src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/h.min.js"></script>
<script type="text/javascript" src="../js/web3.min.js"></script>
<script type="text/javascript" src="../js/hooked-web3-provider.min.js"></script>
<script type="text/javascript" src="../js/lightwallet.min.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/common.js">
</script>
<script type="text/javascript">
	mui.init()
	document.getElementById('lead-wallet').addEventListener('tap', function() {
		mui.openWindow('importWallet.html');
	});

	h('#creat-wallet').tap(function() {
		let walletName = h('#walletName').val(),
			pwd = h('#tbPassword').val(),
			confirmPwd = h('#confirmPwd').val(),
			agree = document.getElementById('check1').checked;

		if(walletName == '') {
			mui.alert('请输入钱包名称!');
			return
		} else if(pwd == '' || confirmPwd == '') {
			mui.alert('请输入密码!');
			return;
		} else if(pwd !== confirmPwd) {
			mui.alert('请确认您的密码,两次密码不一致');
			h('#tbPassword').val('')
			h('#confirmPwd').val('')
			return;
		} else if(!agree) {
			mui.alert('请选择是否同意服务及隐私条款');
			return
		} else if(isPasswd(pwd)) {
			newWallet(pwd, function(addresses, ks) {
				let walletNum = window.localStorage.walletNum;
				if(walletNum == undefined) {
					walletNum = 0;
					window.localStorage[walletNum] = JSON.stringify({
						'walletName': walletName,
						'address': addresses,
						'keyStore': JSON.stringify(ks)
					});
					window.localStorage.walletNum = walletNum++;
				} else {
					walletNum = ++walletNum;
					window.localStorage[walletNum] = JSON.stringify({
						'walletName': walletName,
						'address': addresses,
						'keyStore': JSON.stringify(ks)
					});
					window.localStorage.walletNum = walletNum;
				}
				openInfo('../../index.html')
			});
			return;
		} else {
			mui.alert('请按规则设置密码,密码不得少于8位字符,建议混合大小写字母、数字、特殊字符')
			h('#tbPassword').val('')
			h('#confirmPwd').val('')
			return
		}
	})

	function isPasswd(s) {
		var patrn = /^(\w){8,20}$/;
		if(!patrn.exec(s)) return false
		return true
	}
</script>

<!--密码校验强度-->

<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js">
</script>

<script type="text/javascript">
	$('#tbPassword').focus(function() {
		$('#pwdLevel_1').attr('class', 'ywz_zhuce_hongxian');
		$('#tbPassword').keyup();
	});

	$('#tbPassword').keyup(function() {
		var __th = $(this);

		if(!__th.val()) {
			$('#pwd_tip').hide();
			$('#pwd_err').show();
			Primary();
			return;
		}
		if(__th.val().length < 8) {
			$('#pwd_tip').hide();
			$('#pwd_err').show();
			Weak();
			return;
		}
		var _r = checkPassword(__th);
		if(_r < 1) {
			$('#pwd_tip').hide();
			$('#pwd_err').show();
			Primary();
			return;
		}

		if(_r > 0 && _r < 2) {
			Weak();
		} else if(_r >= 2 && _r < 4) {
			Medium();
		} else if(_r >= 4) {
			Tough();
		}

		$('#pwd_tip').hide();
		$('#pwd_err').hide();
	});

	function Primary() {
		$('#pwdLevel_1').attr('class', 'ywz_zhuce_huixian');
		$('#pwdLevel_2').attr('class', 'ywz_zhuce_huixian');
		$('#pwdLevel_3').attr('class', 'ywz_zhuce_huixian');
	}

	function Weak() {
		$('#pwdLevel_1').attr('class', 'ywz_zhuce_hongxian');
		$('#pwdLevel_2').attr('class', 'ywz_zhuce_huixian');
		$('#pwdLevel_3').attr('class', 'ywz_zhuce_huixian');
	}

	function Medium() {
		$('#pwdLevel_1').attr('class', 'ywz_zhuce_hongxian');
		$('#pwdLevel_2').attr('class', 'ywz_zhuce_hongxian2');
		$('#pwdLevel_3').attr('class', 'ywz_zhuce_huixian');
	}

	function Tough() {
		$('#pwdLevel_1').attr('class', 'ywz_zhuce_hongxian');
		$('#pwdLevel_2').attr('class', 'ywz_zhuce_hongxian2');
		$('#pwdLevel_3').attr('class', 'ywz_zhuce_hongxian3');
	}

	function checkPassword(pwdinput) {
		var maths, smalls, bigs, corps, cat, num;
		var str = $(pwdinput).val()
		var len = str.length;

		var cat = /.{16}/g
		if(len == 0) return 1;
		if(len > 16) {
			$(pwdinput).val(str.match(cat)[0]);
		}
		cat = /.*[\u4e00-\u9fa5]+.*$/
		if(cat.test(str)) {
			return -1;
		}
		cat = /\d/;
		var maths = cat.test(str);
		cat = /[a-z]/;
		var smalls = cat.test(str);
		cat = /[A-Z]/;
		var bigs = cat.test(str);
		var corps = corpses(pwdinput);
		var num = maths + smalls + bigs + corps;

		if(len < 6) {
			return 1;
		}

		if(len >= 6 && len <= 8) {
			if(num == 1) return 1;
			if(num == 2 || num == 3) return 2;
			if(num == 4) return 3;
		}

		if(len > 8 && len <= 11) {
			if(num == 1) return 2;
			if(num == 2) return 3;
			if(num == 3) return 4;
			if(num == 4) return 5;
		}

		if(len > 11) {
			if(num == 1) return 3;
			if(num == 2) return 4;
			if(num > 2) return 5;
		}
	}

	function corpses(pwdinput) {
		var cat = /./g
		var str = $(pwdinput).val();
		var sz = str.match(cat)
		for(var i = 0; i < sz.length; i++) {
			cat = /\d/;
			maths_01 = cat.test(sz[i]);
			cat = /[a-z]/;
			smalls_01 = cat.test(sz[i]);
			cat = /[A-Z]/;
			bigs_01 = cat.test(sz[i]);
			if(!maths_01 && !smalls_01 && !bigs_01) {
				return true;
			}
		}
		return false;
	}
</script>